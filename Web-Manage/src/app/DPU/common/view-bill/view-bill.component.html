<!-- Bill Summary Modern Card -->
<div class="bill-summary-card">
  <!-- Customer / Table / Amount -->
  <div class="bill-section">
    <div class="bill-row">
      <span>ลูกค้า</span>
      <span class="bill-strong bill-color">{{ reservation.user.name || reservation.user.phone || '-' }}</span>
    </div>
    <div class="bill-row">
      <span>โต๊ะ/ห้อง</span>
      <span>
        <ng-container *ngIf="reservation.table">โต๊ะ {{ reservation.table.table_number }}</ng-container>
        <ng-container *ngIf="reservation.room">ห้อง {{ reservation.room.room_name }}</ng-container>
      </span>
    </div>
    <div class="bill-row bill-total">
      <span>ยอดรวม</span>
      <span class="bill-total-amount">{{ getTotalAmount() | number:'1.2-2' }} ฿</span>
    </div>
  </div>

  <!-- Order Items -->
  <div class="bill-list-section">
    <h4><i class="ri-restaurant-line"></i> รายการอาหาร</h4>
    <ul>
      <li *ngFor="let item of getAllOrderItems()">
        <div class="item-info">
          <img [src]="item.menu.image_url ? item.menu.getPicture() : './assets/images/faces/111.jpg'" />
          <span>
            {{ item.menu.name }} <span *ngIf="item.quantity > 1" class="qty-info">x{{ item.quantity }} ({{ item.menu.price | number:'1.2-2' }} ฿)</span>
          </span>
        </div>
        <span class="item-amount">
          {{ item.menu.price * item.quantity | number:'1.2-2' }} ฿
        </span>
      </li>
    </ul>
    <div *ngIf="getAllOrderItems().length === 0" class="bill-list-empty">
      <i class="ri-alert-line mr-1"></i> ไม่มีข้อมูลรายการอาหาร
    </div>
  </div>

  <!-- Payment & Slip -->
  <div *ngIf="reservation.status === 'checked_out' || reservation.status === 'completed'" class="bill-pay-section">
    <h4><i class="ri-money-dollar-circle-line"></i> ชำระเงิน</h4>
    <div *ngIf="reservation.payments && reservation.payments[0]">
      <div class="pay-info">
        <span class="pay-amount">{{ reservation.payments[0].amount | number:'1.2-2' }} ฿</span>
        <span class="pay-status"
              [ngClass]="reservation.payments[0].status === 'completed' || reservation.status === 'completed'
              ? 'pay-status-completed' : 'pay-status-waiting'">
          {{ reservation.payments[0].status === 'completed' || reservation.status === 'completed'
          ? 'ชำระแล้ว' : 'รอตรวจสอบ' }}
        </span>
      </div>
      <div *ngIf="reservation.payments[0].slip_url" class="slip-img-wrap">
        <img [src]="urlLink + reservation.payments[0].slip_url" alt="Slip" />
      </div>
      <div *ngIf="!reservation.payments[0].slip_url || reservation.status === 'checked_out'">
        <dropzone class="dropzone-container" [config]="config" [disabled]="disabled"
          [message]="'คลิกหรือวางไฟล์สลิปที่นี่เพื่ออัปโหลด'" (init)="onUploadInit($event)"
          (error)="onUploadError($event)" (success)="onUploadSuccess($event)">
        </dropzone>
        <button type="button" class="ti-btn ti-btn-success ti-btn-xs mt-3 w-full" (click)="submitSlip()">
          <i class="ri-upload-cloud-2-line mr-1"></i> อัปโหลดสลิป
        </button>
      </div>
    </div>
  </div>

  <!-- ปุ่มเช็คบิล สำหรับยังไม่เช็คบิล -->
  <div *ngIf="reservation.status != 'completed' && reservation.status != 'checked_out'"
    class="bill-checkout-btn-wrap">
    <button class="ti-btn ti-btn-success ti-btn-lg bill-checkout-btn"
      (click)="checkBill()" data-hs-overlay="#view-bill">
      <i class="ri-bill-line"></i> เช็คบิล/ชำระเงิน
    </button>
  </div>
</div>
