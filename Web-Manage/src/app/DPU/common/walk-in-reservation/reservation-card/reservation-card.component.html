<!-- มีการจอง -->
<div class="box kanban-tasks todo shadow-md rounded-xl border-2 border-rose-400 mb-4 bg-white dark:bg-neutral-900 transition-all duration-150 hover:scale-[1.015]" style="min-width:270px;">
  <div class="box-body !p-0">
    <div class="p-4 bg-gradient-to-r from-rose-100/80 to-white/80 dark:from-rose-900/10 dark:to-black/5 rounded-t-xl">
      <div class="flex justify-between items-center mb-1 text-base font-semibold text-rose-500">
        <span class="inline-flex items-center gap-1">
          <i class="ri-calendar-check-line mr-1"></i>
          {{ reservation.start_time | date: 'short' }}
          <span class="mx-1 text-gray-400">-</span>
          {{ reservation.end_time | date: 'shortTime' }}
        </span>
        <span class="badge bg-secondary/10 text-secondary px-2 rounded-full shadow-sm">
          <i class="ri-reserved-line align-middle mr-1"></i>
          {{ reservation.table ? 'โต๊ะ #' + reservation.table.table_number : 'ห้อง: ' + (reservation.room?.name || '-') }}
        </span>
      </div>
      <div class="flex items-center justify-between mt-2 mb-1">
        <span class="badge bg-blue-50 text-blue-600 px-3 py-1 rounded-md font-medium flex items-center gap-1">
          <i class="ri-user-fill"></i>
          {{ reservation.num_people || '-' }} คน
        </span>
        <div class="flex gap-2">
          <button class="ti-btn ti-btn-success ti-btn-xs !rounded" (click)="onCheckIn()">
            <i class="ri-login-circle-line mr-1"></i>Check-in
          </button>
          <button class="ti-btn ti-btn-danger ti-btn-xs !rounded" (click)="onCancel()">
            <i class="ri-close-line mr-1"></i>ยกเลิก
          </button>
        </div>
      </div>
      <div class="flex items-center mt-3 gap-2">
        <i class="ri-user-3-line text-gray-400"></i>
        <span class="font-semibold text-gray-800 dark:text-white">
          {{ reservation.user.name || reservation.user.phone || reservation.user_id || '-' }}
        </span>
        <span *ngIf="reservation.user?.phone" class="ml-1 text-gray-400">({{ reservation.user.phone }})</span>
      </div>
      <div *ngIf="reservation.table || reservation.room" class="mt-1 text-xs text-gray-500 dark:text-gray-300 flex gap-2">
        <ng-container *ngIf="reservation.table">
          <i class="ri-table-2 text-blue-400"></i>
          <span>ขนาด {{ reservation.table.capacity }} ที่นั่ง</span>
        </ng-container>
        <ng-container *ngIf="reservation.room">
          <i class="ri-door-lock-fill text-amber-400"></i>
          <span>ขนาด {{ reservation.room.capacity }} คน</span>
        </ng-container>
      </div>
      <div class="mt-2 flex flex-col gap-1 text-xs text-gray-500 dark:text-gray-300">
        <div *ngIf="reservation.note" class="italic bg-gray-100 dark:bg-neutral-800 px-2 py-1 rounded">หมายเหตุ: {{ reservation.note }}</div>
      </div>
    </div>
    <div class="p-4 border-t border-dashed dark:border-defaultborder/10 rounded-b-xl bg-gray-50 dark:bg-neutral-800">
      <div *ngIf="reservation.orders.length > 0" class="mb-2">
        <div class="font-semibold text-xs text-gray-700 dark:text-gray-200 mb-1">รายการอาหารที่จอง:</div>
        <ul class="list-disc ml-5">
          <li *ngFor="let order of reservation.orders">
            <span *ngFor="let oi of order.order_items">
              {{ oi.menu.name }} <span *ngIf="oi.quantity > 1">x{{oi.quantity}}</span>
            </span>
          </li>
        </ul>
      </div>
      <div *ngIf="reservation.payments?.length">
        <span class="text-xs text-green-500"><i class="ri-money-dollar-circle-line"></i> มีการชำระเงินแล้ว</span>
      </div>
    </div>
  </div>
</div>
